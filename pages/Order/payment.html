<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flowery Bouquet Online Shopping</title>
    <link rel="stylesheet" href="../../asset/Style/payment.css" />
  </head>
  <body>
    <form id="form">
      <div class="images">
        <img
          id="google1"
          src="../../asset/IMG/index/google-pay (1).png"
          width="50px"
        /><br />
        <img
          id="wallet1"
          src="../../asset/IMG/index/wallet (1).png"
          width="50px"
        /><br /><br /><br />
        <img
          id="atm1"
          src="../../asset/IMG/index/atm-card.png"
          width="50px"
        /><br /><br /><br />
        <img
          id="net1"
          src="../../asset/IMG/index/cashless-payment (1).png"
          width="50px"
        /><br /><br />
        <img
          id="delivery1"
          src="../../asset/IMG/index/cash-on-delivery (1).png"
          width="50px"
        />
      </div>
      <h2>Select Payment method</h2>
      <h3>Pay online and get EXTRA 13 off</h3>
      <div id="pay">
        <input
          class="payment_option"
          type="radio"
          id="UPI"
          name="paymethod"
          value="UPI"
          required
        />
        <label for="gpay">UPI(Gpay/phonepay/Paytm)</label><br />
        <hr />
        <input
          class="payment_option"
          type="radio"
          id="Wallet"
          name="paymethod"
          value="wallet"
          required
        />
        <label for="paytm">Wallet/Postpaid</label><br />
        <hr />
        <input
          class="payment_option"
          type="radio"
          id="Credit"
          name="paymethod"
          value="Debite"
          required
        />
        <label for="phonepay">Debite/Credit Cards</label>
        <hr />
        <input
          class="payment_option"
          type="radio"
          id="Banking"
          name="paymethod"
          value="netbanking"
          required
        />
        <label for="phonepay">Net Banking</label>
        <hr />
        <input
          class="payment_option"
          type="radio"
          id="delivery"
          name="paymethod"
          value="cash-on-delivery"
          required
        />
        <label for="delivery">Cash on delivery</label>

        <hr />
      </div>
      <div class="btn">
        <a href="../../pages/Home.html"
          ><button type="button">Cancel</button></a
        >
        <a href="../../pages/Order/Order.html"
          ><button type="submit" id="order">Place Order</button>
        </a>
      </div>
    </form>

    <script>
      let newdate;
      let dateObj = new Date();
      let month = dateObj.getUTCMonth() + 1; //months from 1-12
      let day = dateObj.getUTCDate();
      let year = dateObj.getUTCFullYear();
      newdate = day + "/" + month + "/" + year;
      console.log(newdate);

      // orders id code
      let order_id = Date.now();
      console.log(order_id);

      let bouquets = JSON.parse(localStorage.getItem("bouquet"));
      let cart = JSON.parse(localStorage.getItem("Cart"));


      const url = window.location.search;
      console.log(url);
      const urlparams = new URLSearchParams(url);
      console.log(urlparams);
      const urlserached_value = urlparams.get("id");
      console.log(urlserached_value);

      let result;
      let product;

      if (Number(urlserached_value) == urlserached_value) {
        let bouquet = bouquets.find((e) => {
          if (e["product_id"] == urlserached_value) {
            product = e;
            return;
          } 
        });
      } 
      else {
        let bouquet = cart.find((e) => {
          if (e["emailid"] == urlserached_value) {
            product = e;
          } 
        });
      }

      console.log(product);

      let form = document.getElementById("form");
      form.addEventListener("submit", function (el) {
        el.preventDefault();

        let payment_option = document.querySelector(
          ".payment_option:checked"
        ).value;
        console.log(payment_option);

        let user = JSON.parse(localStorage.getItem("active_user"));
        let order = JSON.parse(localStorage.getItem("order")) ?? [];

        if (Number(urlserached_value) == urlserached_value) {
          let obj = {};

          obj["img"] = product["img"];
          obj["price"] = product["price"];
          obj["product_id"] = product["product_id"];
          obj["order_id"] = order_id;
          obj["order_date"] = newdate;
          obj["payment_option"] = payment_option;
          obj["address"] = product["address"];
          obj["tittle"] = product["tittle"];
          obj["emailid"] = user["emailid"];
          

          order.push(obj);
          localStorage.setItem("order", JSON.stringify(order));
        } 
        else {
          cart.find((element) => {
            if (element.emailid == user.emailid) {
              let obj = {};

              obj["img"] = element["img"];
              obj["price"] = element["price"];
              obj["product_id"] = element["product_id"];
              obj["order_id"] = order_id;
              obj["order_date"] = newdate;
              obj["payment_option"] = payment_option;
              obj["address"] = element["address"];
              obj["tittle"] = element["tittle"];
              obj["emailid"] = user["emailid"];

              order.push(obj);
              localStorage.setItem("order", JSON.stringify(order));
            }
          });
        }

        window.location.href = "Order.html";
      });
    </script>
  </body>
</html>
